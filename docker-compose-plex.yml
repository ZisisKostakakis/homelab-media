# Plex Media Server Stack
# Independent stack for Plex - can run separately from torrent automation

services:
  plex:
    image: lscr.io/linuxserver/plex
    container_name: plex
    network_mode: host
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:32400/identity"]
      interval: 2m
      timeout: 30s  
      retries: 2
      start_period: 5m
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
      - VERSION=docker
      - PLEX_CLAIM=${PLEX_CLAIM}
    volumes:
      - /var/lib/homelab-media-configs/plex:/config
      - /mnt/media/transcode:/transcode
      - /mnt/media:/data
    devices:
      - /dev/dri:/dev/dri
    restart: unless-stopped

  suggestarr:
    image: ciuse99/suggestarr:latest
    container_name: SuggestArr
    restart: always
    ports:
      - "${SUGGESTARR_PORT:-5000}:${SUGGESTARR_PORT:-5000}"
    volumes:
      - /var/lib/homelab-media-configs/suggestarr:/app/config/config_files
    environment:
      - LOG_LEVEL=${LOG_LEVEL:-info}
      - SUGGESTARR_PORT=${SUGGESTARR_PORT:-5000}
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://127.0.0.1:${SUGGESTARR_PORT:-5000}"]
      interval: 1m
      timeout: 10s
      retries: 3
      start_period: 2m
    networks:
      - media_network

  kitana:
    image: pannal/kitana:latest
    container_name: kitana
    restart: unless-stopped
    ports:
      - "${KITANA_PORT:-31337}:31337"
    volumes:
      - /var/lib/homelab-media-configs/kitana:/app/data
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    command: -B 0.0.0.0:31337
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://127.0.0.1:31337"]
      interval: 1m
      timeout: 10s
      retries: 3
      start_period: 30s
    networks:
      - media_network

  tautulli:
    image: lscr.io/linuxserver/tautulli:latest
    container_name: tautulli
    restart: unless-stopped
    ports:
      - "${TAUTULLI_PORT:-8787}:8181"
    volumes:
      - /var/lib/homelab-media-configs/tautulli:/config
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8181/status"]
      interval: 1m
      timeout: 10s
      retries: 3
      start_period: 1m
    networks:
      - media_network

#  kometa:
#    image: kometateam/kometa:latest
#    container_name: kometa
#    restart: unless-stopped
#    volumes:
#      - /var/lib/homelab-media-configs/kometa:/config
#    environment:
#      - PUID=${PUID}
#      - PGID=${PGID}
#      - TZ=${TZ}
#      - KOMETA_RUN=${KOMETA_RUN:-false}
#      - KOMETA_TIME=${KOMETA_TIME:-05:00}
#    networks:
#      - media_network

  plex-trakt-sync:
    image: ghcr.io/taxel/plextraktsync:latest
    container_name: plex-trakt-sync
    restart: "no"
    network_mode: host
    volumes:
      - /var/lib/homelab-media-configs/plex-trakt-sync:/app/config
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    command: ["watch"]
    profiles:
      - manual

networks:
  media_network:
    external: true
    name: homelab_media_network
